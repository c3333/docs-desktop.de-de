---
title: 'Gewusst wie: Behandeln des ContextMenuOpening -Ereignisses'
ms.date: 03/30/2017
helpviewer_keywords:
- ContextMenuOpening properties [WPF]
ms.assetid: 789652fb-1951-4217-934a-7843e355adf4
ms.openlocfilehash: b3d0f5c77ebf8527e4854d4edf12d6fa8a4b5f0c
ms.sourcegitcommit: 9f6df084c53a3da0ea657ed0d708a72213683084
ms.translationtype: MT
ms.contentlocale: de-DE
ms.lasthandoff: 12/09/2020
ms.locfileid: "96976681"
---
# <a name="how-to-handle-the-contextmenuopening-event"></a><span data-ttu-id="13466-102">Gewusst wie: Behandeln des ContextMenuOpening -Ereignisses</span><span class="sxs-lookup"><span data-stu-id="13466-102">How to: Handle the ContextMenuOpening Event</span></span>
<span data-ttu-id="13466-103">Das <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis kann in einer Anwendung behandelt werden, um entweder ein vorhandenes Kontextmenü vor der Anzeige anzupassen oder das Menü zu unterdrücken, das andernfalls angezeigt würde, indem die- <xref:System.Windows.RoutedEventArgs.Handled%2A> Eigenschaft `true` in den Ereignisdaten auf festgelegt wird.</span><span class="sxs-lookup"><span data-stu-id="13466-103">The <xref:System.Windows.FrameworkElement.ContextMenuOpening> event can be handled in an application to either adjust an existing context menu prior to display or to suppress the menu that would otherwise be displayed by setting the <xref:System.Windows.RoutedEventArgs.Handled%2A> property to `true` in the event data.</span></span> <span data-ttu-id="13466-104">Der typische Grund für das Festlegen von <xref:System.Windows.RoutedEventArgs.Handled%2A> `true` in den Ereignisdaten besteht darin, das Menü vollständig durch ein neues Objekt zu ersetzen <xref:System.Windows.Controls.ContextMenu> , das manchmal das Abbrechen des Vorgangs und das Starten eines neuen geöffneten erfordert.</span><span class="sxs-lookup"><span data-stu-id="13466-104">The typical reason for setting <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data is to replace the menu entirely with a new <xref:System.Windows.Controls.ContextMenu> object, which sometimes requires canceling the operation and starting a new open.</span></span> <span data-ttu-id="13466-105">Wenn Sie Handler für das- <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis schreiben, sollten Sie Zeit Steuerungsprobleme zwischen einem <xref:System.Windows.Controls.ContextMenu> -Steuerelement und dem-Dienst beachten, der für das Öffnen und Positionieren von Kontextmenüs für Steuerelemente im allgemeinen zuständig ist.</span><span class="sxs-lookup"><span data-stu-id="13466-105">If you write handlers for the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event, you should be aware of timing issues between a <xref:System.Windows.Controls.ContextMenu> control and the service that is responsible for opening and positioning context menus for controls in general.</span></span> <span data-ttu-id="13466-106">In diesem Thema werden einige der Code Techniken für verschiedene Szenarien zum Öffnen von Kontextmenüs erläutert, und es wird ein Fall veranschaulicht, in dem das Problem mit der zeitlichen Steuerung auftritt.</span><span class="sxs-lookup"><span data-stu-id="13466-106">This topic illustrates some of the code techniques for various context menu opening scenarios and illustrates a case where the timing issue comes into play.</span></span>  
  
 <span data-ttu-id="13466-107">Es gibt mehrere Szenarien für die Behandlung des <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignisses:</span><span class="sxs-lookup"><span data-stu-id="13466-107">There are several scenarios for handling the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event:</span></span>  
  
- <span data-ttu-id="13466-108">Anpassen der Menü Elemente vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="13466-108">Adjusting the menu items before display.</span></span>  
  
- <span data-ttu-id="13466-109">Ersetzt das gesamte Menü vor der Anzeige.</span><span class="sxs-lookup"><span data-stu-id="13466-109">Replacing the entire menu before display.</span></span>  
  
- <span data-ttu-id="13466-110">Vollständiges unterdrücken vorhandener Kontextmenüs und Anzeigen eines Kontextmenüs</span><span class="sxs-lookup"><span data-stu-id="13466-110">Completely suppressing any existing context menu and displaying no context menu.</span></span>  
  
## <a name="example"></a><span data-ttu-id="13466-111">Beispiel</span><span class="sxs-lookup"><span data-stu-id="13466-111">Example</span></span>  
  
## <a name="adjusting-the-menu-items-before-display"></a><span data-ttu-id="13466-112">Anpassen der Menü Elemente vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="13466-112">Adjusting the Menu Items Before Display</span></span>  
 <span data-ttu-id="13466-113">Das Anpassen der vorhandenen Menü Elemente ist ziemlich einfach und ist wahrscheinlich das gängigste Szenario.</span><span class="sxs-lookup"><span data-stu-id="13466-113">Adjusting the existing menu items is fairly simple and is probably the most common scenario.</span></span> <span data-ttu-id="13466-114">Dies können Sie tun, um Kontextmenü Optionen als Reaktion auf aktuelle Zustandsinformationen in der Anwendung oder bestimmte Zustandsinformationen, die als Eigenschaft für das Objekt verfügbar sind, in dem das Kontextmenü angefordert wird, hinzuzufügen oder zu subtrahieren.</span><span class="sxs-lookup"><span data-stu-id="13466-114">You might do this in order to add or subtract context menu options in response to current state information in your application or particular state information that is available as a property on the object where the context menu is requested.</span></span>  
  
 <span data-ttu-id="13466-115">Das allgemeine Verfahren besteht darin, die Quelle des Ereignisses, d. h. das spezifische Steuerelement, auf das mit der rechten Maustaste geklickt wurde, zu erhalten und die- <xref:System.Windows.FrameworkElement.ContextMenu%2A> Eigenschaft daraus zu erhalten.</span><span class="sxs-lookup"><span data-stu-id="13466-115">The general technique is to get the source of the event, which is the specific control that was right-clicked, and get the <xref:System.Windows.FrameworkElement.ContextMenu%2A> property from it.</span></span> <span data-ttu-id="13466-116">In der Regel sollten Sie die Sammlung überprüfen, <xref:System.Windows.Controls.ItemsControl.Items%2A> um festzustellen, welche Kontextmenü Elemente bereits im Menü vorhanden sind, und dann <xref:System.Windows.Controls.MenuItem> die entsprechenden neuen Elemente zu oder aus der Auflistung hinzufügen oder daraus entfernen.</span><span class="sxs-lookup"><span data-stu-id="13466-116">You typically want to check the <xref:System.Windows.Controls.ItemsControl.Items%2A> collection to see what context menu items already exist in the menu, and then add or remove appropriate new <xref:System.Windows.Controls.MenuItem> items to or from the collection.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#AddItemNoHandle](~/samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#additemnohandle)]  
  
## <a name="replacing-the-entire-menu-before-display"></a><span data-ttu-id="13466-117">Ersetzen des gesamten Menüs vor der Anzeige</span><span class="sxs-lookup"><span data-stu-id="13466-117">Replacing the Entire Menu Before Display</span></span>  
 <span data-ttu-id="13466-118">Ein alternatives Szenario besteht darin, das gesamte Kontextmenü zu ersetzen.</span><span class="sxs-lookup"><span data-stu-id="13466-118">An alternative scenario is if you want to replace the entire context menu.</span></span> <span data-ttu-id="13466-119">Sie könnten natürlich auch eine Variation des vorangehenden Codes verwenden, um alle Elemente eines vorhandenen Kontextmenüs zu entfernen und neue Elemente hinzuzufügen, beginnend mit dem Element 0.</span><span class="sxs-lookup"><span data-stu-id="13466-119">You could of course also use a variation of the preceding code, to remove every item of an existing context menu and add new ones starting with item zero.</span></span> <span data-ttu-id="13466-120">Der intuitivste Ansatz, alle Elemente im Kontextmenü zu ersetzen, besteht darin, einen neuen zu erstellen <xref:System.Windows.Controls.ContextMenu> , ihn mit Elementen zu füllen und dann die- <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> Eigenschaft eines Steuer Elements auf den neuen festzulegen <xref:System.Windows.Controls.ContextMenu> .</span><span class="sxs-lookup"><span data-stu-id="13466-120">But the more intuitive approach for replacing all items in the context menu is to create a new <xref:System.Windows.Controls.ContextMenu>, populate it with items, and then set the <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property of a control to be the new <xref:System.Windows.Controls.ContextMenu>.</span></span>  
  
 <span data-ttu-id="13466-121">Im folgenden finden Sie den einfachen Handlercode zum Ersetzen von <xref:System.Windows.Controls.ContextMenu> .</span><span class="sxs-lookup"><span data-stu-id="13466-121">The following is the simple handler code for replacing a <xref:System.Windows.Controls.ContextMenu>.</span></span> <span data-ttu-id="13466-122">Der Code verweist auf eine benutzerdefinierte `BuildMenu` Methode, die getrennt ist, da Sie von mehr als einem der Beispiel Handler aufgerufen wird.</span><span class="sxs-lookup"><span data-stu-id="13466-122">The code references a custom `BuildMenu` method, which is separated out because it is called by more than one of the example handlers.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceNoReopen](~/samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacenoreopen)]  
  
 [!code-csharp[ContextMenuOpeningHandlers#BuildMenu](~/samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#buildmenu)]  
  
 <span data-ttu-id="13466-123">Wenn Sie jedoch diese Art von Handler für verwenden <xref:System.Windows.FrameworkElement.ContextMenuOpening> , können Sie möglicherweise ein Problem mit der zeitlichen Steuerung verfügbar machen, wenn das Objekt, in dem Sie festlegen, <xref:System.Windows.Controls.ContextMenu> nicht über ein vorhandenes Kontextmenü verfügt.</span><span class="sxs-lookup"><span data-stu-id="13466-123">However, if you use this style of handler for <xref:System.Windows.FrameworkElement.ContextMenuOpening>, you can potentially expose a timing issue if the object where you are setting the <xref:System.Windows.Controls.ContextMenu> does not have a preexisting context menu.</span></span> <span data-ttu-id="13466-124">Wenn ein Benutzer mit der rechten Maustaste auf ein-Steuerelement klickt, <xref:System.Windows.FrameworkElement.ContextMenuOpening> wird auch dann ausgelöst, wenn der vorhandene <xref:System.Windows.Controls.ContextMenu> leer oder NULL ist.</span><span class="sxs-lookup"><span data-stu-id="13466-124">When a user right-clicks a control, <xref:System.Windows.FrameworkElement.ContextMenuOpening> is raised even if the existing <xref:System.Windows.Controls.ContextMenu> is empty or null.</span></span> <span data-ttu-id="13466-125">In diesem Fall wird allerdings, was <xref:System.Windows.Controls.ContextMenu> für das Quell Element festgelegt wurde, zu spät angezeigt, um angezeigt zu werden.</span><span class="sxs-lookup"><span data-stu-id="13466-125">But in this case, whatever new <xref:System.Windows.Controls.ContextMenu> you set on the source element arrives too late to be displayed.</span></span> <span data-ttu-id="13466-126">Wenn der Benutzer mit der rechten Maustaste auf ein zweites Mal klickt, wird das neue angezeigt, <xref:System.Windows.Controls.ContextMenu> der Wert ist nicht NULL, und der Handler ersetzt das Menü ordnungsgemäß und zeigt es an, wenn der Handler ein zweites Mal ausgeführt wird.</span><span class="sxs-lookup"><span data-stu-id="13466-126">Also, if the user happens to right-click a second time, this time your new <xref:System.Windows.Controls.ContextMenu> appears, the value is non null, and your handler will properly replace and display the menu when the handler runs a second time.</span></span> <span data-ttu-id="13466-127">Dies deutet auf zwei mögliche Problem Umgehungen hin:</span><span class="sxs-lookup"><span data-stu-id="13466-127">This suggests two possible workarounds:</span></span>  
  
1. <span data-ttu-id="13466-128">Stellen Sie sicher, dass <xref:System.Windows.FrameworkElement.ContextMenuOpening> Handler immer für Steuerelemente ausgeführt werden, die mindestens über einen Platzhalter verfügen <xref:System.Windows.Controls.ContextMenu> , der durch den Handlercode ersetzt werden soll.</span><span class="sxs-lookup"><span data-stu-id="13466-128">Insure that <xref:System.Windows.FrameworkElement.ContextMenuOpening> handlers always run against controls that have at least a placeholder <xref:System.Windows.Controls.ContextMenu> available, which you intend to be replaced by the handler code.</span></span> <span data-ttu-id="13466-129">In diesem Fall können Sie weiterhin den im vorherigen Beispiel gezeigten Handler verwenden, Sie möchten jedoch in der Regel einen Platzhalter <xref:System.Windows.Controls.ContextMenu> im anfänglichen Markup zuweisen:</span><span class="sxs-lookup"><span data-stu-id="13466-129">In this case, you can still use the handler shown in the previous example, but you typically want to assign a placeholder <xref:System.Windows.Controls.ContextMenu> in the initial markup:</span></span>  
  
     [!code-xaml[ContextMenuOpeningHandlers#XAMLWithInitCM](~/samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml#xamlwithinitcm)]  
  
2. <span data-ttu-id="13466-130">Nehmen Sie an, dass der Anfangs <xref:System.Windows.Controls.ContextMenu> Wert auf der Grundlage einer vorläufigen Logik NULL sein kann.</span><span class="sxs-lookup"><span data-stu-id="13466-130">Assume that the initial <xref:System.Windows.Controls.ContextMenu> value might be null, based on some preliminary logic.</span></span> <span data-ttu-id="13466-131">Sie können entweder <xref:System.Windows.Controls.ContextMenu> auf NULL prüfen oder ein Flag in Ihrem Code verwenden, um zu überprüfen, ob der Handler mindestens einmal ausgeführt wurde.</span><span class="sxs-lookup"><span data-stu-id="13466-131">You could either check <xref:System.Windows.Controls.ContextMenu> for null, or use a flag in your code to check whether your handler has been run at least once.</span></span> <span data-ttu-id="13466-132">Da Sie davon ausgehen, dass der <xref:System.Windows.Controls.ContextMenu> angezeigt wird, legt der Handler <xref:System.Windows.RoutedEventArgs.Handled%2A> `true` in den Ereignisdaten auf fest.</span><span class="sxs-lookup"><span data-stu-id="13466-132">Because you assume that the <xref:System.Windows.Controls.ContextMenu> is about to be displayed, your handler then sets <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="13466-133">Der, der <xref:System.Windows.Controls.ContextMenuService> für die Anzeige des Kontextmenüs zuständig ist, `true` stellt ein Wert für <xref:System.Windows.RoutedEventArgs.Handled%2A> in den Ereignisdaten eine Anforderung dar, die Anzeige für die Kontextmenü-/steuerungkombination abzubrechen, die das Ereignis ausgelöst hat.</span><span class="sxs-lookup"><span data-stu-id="13466-133">To the <xref:System.Windows.Controls.ContextMenuService> that is responsible for context menu display, a `true` value for <xref:System.Windows.RoutedEventArgs.Handled%2A> in the event data represents a request to cancel the display for the context menu / control combination that raised the event.</span></span>  
  
 <span data-ttu-id="13466-134">Nachdem Sie das potenziell Fehler verdächtige Kontextmenü unterdrückt haben, besteht der nächste Schritt darin, eine neue bereitzustellen und diese dann anzuzeigen.</span><span class="sxs-lookup"><span data-stu-id="13466-134">Now that you have suppressed the potentially suspect context menu, the next step is to supply a new one, then display it.</span></span> <span data-ttu-id="13466-135">Das Festlegen der neuen ist im Grunde das gleiche wie der vorherige Handler: Sie erstellen ein neues <xref:System.Windows.Controls.ContextMenu> und legen die-Eigenschaft der Steuerelement Quelle <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> darauf fest.</span><span class="sxs-lookup"><span data-stu-id="13466-135">Setting the new one is basically the same as the previous handler: you build a new <xref:System.Windows.Controls.ContextMenu> and set the control source's <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType> property with it.</span></span> <span data-ttu-id="13466-136">Der zusätzliche Schritt besteht darin, dass Sie jetzt die Anzeige des Kontextmenüs erzwingen müssen, da Sie den ersten Versuch unterdrückt haben.</span><span class="sxs-lookup"><span data-stu-id="13466-136">The additional step is that you must now force the display of the context menu, because you suppressed the first attempt.</span></span> <span data-ttu-id="13466-137">Um die Anzeige zu erzwingen, legen Sie die- <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> Eigenschaft `true` innerhalb des-Handlers auf fest.</span><span class="sxs-lookup"><span data-stu-id="13466-137">To force the display, you set the <xref:System.Windows.Controls.Primitives.Popup.IsOpen%2A?displayProperty=nameWithType> property to `true` within the handler.</span></span> <span data-ttu-id="13466-138">Seien Sie vorsichtig, wenn Sie das Kontextmenü des Handlers öffnen, um das <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis erneut auszuführen.</span><span class="sxs-lookup"><span data-stu-id="13466-138">Be careful when you do this, because opening the context menu in the handler raises the <xref:System.Windows.FrameworkElement.ContextMenuOpening> event again.</span></span> <span data-ttu-id="13466-139">Wenn Sie den Handler erneut eingeben, wird er unendlich rekursiv.</span><span class="sxs-lookup"><span data-stu-id="13466-139">If you reenter your handler, it becomes infinitely recursive.</span></span> <span data-ttu-id="13466-140">Aus diesem Grund müssen Sie immer `null` ein Flag suchen oder verwenden, wenn Sie ein Kontextmenü innerhalb eines- <xref:System.Windows.FrameworkElement.ContextMenuOpening> Ereignis Handlers öffnen.</span><span class="sxs-lookup"><span data-stu-id="13466-140">This is why you always need to check for `null` or use a flag if you open a context menu from within a <xref:System.Windows.FrameworkElement.ContextMenuOpening> event handler.</span></span>  
  
## <a name="suppressing-any-existing-context-menu-and-displaying-no-context-menu"></a><span data-ttu-id="13466-141">Unterdrücken eines beliebigen vorhandenen Kontextmenüs und Anzeigen eines Kontextmenüs</span><span class="sxs-lookup"><span data-stu-id="13466-141">Suppressing Any Existing Context Menu and Displaying No Context Menu</span></span>  
 <span data-ttu-id="13466-142">Das abschließende Szenario, das Schreiben eines Handlers, der ein Menü vollständig unterdrückt, ist nicht üblich.</span><span class="sxs-lookup"><span data-stu-id="13466-142">The final scenario, writing a handler that suppresses a menu totally, is uncommon.</span></span> <span data-ttu-id="13466-143">Wenn ein bestimmtes Steuerelement kein Kontextmenü anzeigen soll, gibt es wahrscheinlich geeignetere Möglichkeiten, dies zu gewährleisten, als indem das Menü nur dann unterdrückt wird, wenn ein Benutzer es anfordert.</span><span class="sxs-lookup"><span data-stu-id="13466-143">If a given control is not supposed to display a context menu, there are probably more appropriate ways to assure this than by suppressing the menu just when a user requests it.</span></span> <span data-ttu-id="13466-144">Wenn Sie den Handler jedoch verwenden möchten, um ein Kontextmenü zu unterdrücken und Nothing anzuzeigen, sollte der Handler einfach <xref:System.Windows.RoutedEventArgs.Handled%2A> auf `true` in den Ereignisdaten festlegen.</span><span class="sxs-lookup"><span data-stu-id="13466-144">But if you want to use the handler to suppress a context menu and show nothing, then your handler should simply set <xref:System.Windows.RoutedEventArgs.Handled%2A> to `true` in the event data.</span></span> <span data-ttu-id="13466-145">Der <xref:System.Windows.Controls.ContextMenuService> , der für die Anzeige eines Kontextmenüs zuständig ist, überprüft die Ereignisdaten des Ereignisses, das für das Steuerelement ausgelöst wurde.</span><span class="sxs-lookup"><span data-stu-id="13466-145">The <xref:System.Windows.Controls.ContextMenuService> that is responsible for displaying a context menu will check the event data of the event it raised on the control.</span></span> <span data-ttu-id="13466-146">Wenn das Ereignis an einer <xref:System.Windows.RoutedEventArgs.Handled%2A> beliebigen Stelle entlang der Route markiert wurde, wird die Kontextmenü-Aktion zum Öffnen des Ereignisses unterdrückt.</span><span class="sxs-lookup"><span data-stu-id="13466-146">If the event was marked <xref:System.Windows.RoutedEventArgs.Handled%2A> anywhere along the route, then the context menu open action that initiated the event is suppressed.</span></span>  
  
 [!code-csharp[ContextMenuOpeningHandlers#ReplaceReopen](~/samples/snippets/csharp/VS_Snippets_Wpf/ContextMenuOpeningHandlers/CSharp/Pane1.xaml.cs#replacereopen)]  
  
## <a name="see-also"></a><span data-ttu-id="13466-147">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="13466-147">See also</span></span>

- <xref:System.Windows.Controls.ContextMenu>
- <xref:System.Windows.FrameworkElement.ContextMenu%2A?displayProperty=nameWithType>
- [<span data-ttu-id="13466-148">Übersicht über Basiselemente</span><span class="sxs-lookup"><span data-stu-id="13466-148">Base Elements Overview</span></span>](base-elements-overview.md)
- [<span data-ttu-id="13466-149">Übersicht über ContextMenu</span><span class="sxs-lookup"><span data-stu-id="13466-149">ContextMenu Overview</span></span>](../controls/contextmenu-overview.md)
